<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="一种有趣的数学构筑法 一、引言 在看到某些分段函数时，其中所蕴含的一种“不够直接”的感觉往往令我感到难受。我们是否能找到一种方式，来用任意一个函数拟合各种特别的分段函数呢？\n">
<title>一种有趣的数学构筑尝试</title>

<link rel='canonical' href='https://SJTdreams.github.io/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/'>

<link rel="stylesheet" href="/scss/style.min.d5c1af0ec3575ed0b4a57e01f194815cc1b683bbc03bf86657a689276ff0de65.css"><script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script><meta property='og:title' content="一种有趣的数学构筑尝试">
<meta property='og:description' content="一种有趣的数学构筑法 一、引言 在看到某些分段函数时，其中所蕴含的一种“不够直接”的感觉往往令我感到难受。我们是否能找到一种方式，来用任意一个函数拟合各种特别的分段函数呢？\n">
<meta property='og:url' content='https://SJTdreams.github.io/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/'>
<meta property='og:site_name' content='疏间徒泍の旅途'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='学习' /><meta property='article:tag' content='数学' /><meta property='article:published_time' content='2025-06-04T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-06-05T07:55:38&#43;08:00'/><meta property='og:image' content='https://SJTdreams.github.io/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/title.png' />
<meta name="twitter:title" content="一种有趣的数学构筑尝试">
<meta name="twitter:description" content="一种有趣的数学构筑法 一、引言 在看到某些分段函数时，其中所蕴含的一种“不够直接”的感觉往往令我感到难受。我们是否能找到一种方式，来用任意一个函数拟合各种特别的分段函数呢？\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://SJTdreams.github.io/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/title.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_a1d404548b4dc1a.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">😉</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">疏间徒泍の旅途</a></h1>
            <h2 class="site-description">向着日晖和星辰的梦</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/3493270162245710?spm_id_from=333.1007.0.0'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.0.0-beta2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M488.6 104.1C505.3 122.2 513 143.8 511.9 169.8V372.2C511.5 398.6 502.7 420.3 485.4 437.3C468.2 454.3 446.3 463.2 419.9 464H92.02C65.57 463.2 43.81 454.2 26.74 436.8C9.682 419.4 .7667 396.5 0 368.2V169.8C.7667 143.8 9.682 122.2 26.74 104.1C43.81 87.75 65.57 78.77 92.02 78H121.4L96.05 52.19C90.3 46.46 87.42 39.19 87.42 30.4C87.42 21.6 90.3 14.34 96.05 8.603C101.8 2.868 109.1 0 117.9 0C126.7 0 134 2.868 139.8 8.603L213.1 78H301.1L375.6 8.603C381.7 2.868 389.2 0 398 0C406.8 0 414.1 2.868 419.9 8.603C425.6 14.34 428.5 21.6 428.5 30.4C428.5 39.19 425.6 46.46 419.9 52.19L394.6 78L423.9 78C450.3 78.77 471.9 87.75 488.6 104.1H488.6zM449.8 173.8C449.4 164.2 446.1 156.4 439.1 150.3C433.9 144.2 425.1 140.9 416.4 140.5H96.05C86.46 140.9 78.6 144.2 72.47 150.3C66.33 156.4 63.07 164.2 62.69 173.8V368.2C62.69 377.4 65.95 385.2 72.47 391.7C78.99 398.2 86.85 401.5 96.05 401.5H416.4C425.6 401.5 433.4 398.2 439.7 391.7C446 385.2 449.4 377.4 449.8 368.2L449.8 173.8zM185.5 216.5C191.8 222.8 195.2 230.6 195.6 239.7V273C195.2 282.2 191.9 289.9 185.8 296.2C179.6 302.5 171.8 305.7 162.2 305.7C152.6 305.7 144.7 302.5 138.6 296.2C132.5 289.9 129.2 282.2 128.8 273V239.7C129.2 230.6 132.6 222.8 138.9 216.5C145.2 210.2 152.1 206.9 162.2 206.5C171.4 206.9 179.2 210.2 185.5 216.5H185.5zM377 216.5C383.3 222.8 386.7 230.6 387.1 239.7V273C386.7 282.2 383.4 289.9 377.3 296.2C371.2 302.5 363.3 305.7 353.7 305.7C344.1 305.7 336.3 302.5 330.1 296.2C323.1 289.9 320.7 282.2 320.4 273V239.7C320.7 230.6 324.1 222.8 330.4 216.5C336.7 210.2 344.5 206.9 353.7 206.5C362.9 206.9 370.7 210.2 377 216.5H377z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/SJTdreams/'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于作者</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>相关链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://SJTdreams.github.io/" selected>中文</option>
                                
                                    <option value="https://SJTdreams.github.io/en/" >English</option>
                                
                                    <option value="https://SJTdreams.github.io/ar/" >عربي</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#1锯齿函数">1.锯齿函数</a></li>
    <li><a href="#2百分位数">2.百分位数</a></li>
    <li><a href="#3思考范式">3.思考范式</a></li>
  </ol>

  <ol>
    <li><a href="#单位转化">单位转化</a></li>
    <li><a href="#符号提取">符号提取</a></li>
    <li><a href="#提取小数">提取小数</a></li>
    <li><a href="#非运算">非运算</a></li>
    <li><a href="#与运算">与运算</a></li>
    <li><a href="#或运算">或运算</a></li>
    <li><a href="#异或运算">异或运算</a></li>
    <li><a href="#奇偶切割">奇偶切割</a></li>
    <li><a href="#周期性取值">周期性取值</a></li>
    <li><a href="#判断大小">判断大小</a></li>
    <li><a href="#选择器">选择器</a></li>
    <li><a href="#多重与多重或">多重与&amp;多重或</a></li>
    <li><a href="#判断数值">判断数值</a></li>
    <li><a href="#区间二分">区间二分</a></li>
  </ol>

  <ol>
    <li><a href="#尝试1relu线性整流函数">尝试1：ReLU（线性整流函数）</a></li>
    <li><a href="#尝试2自定义函数">尝试2：自定义函数</a>
      <ol>
        <li><a href="#场景设定">场景设定</a></li>
        <li><a href="#分步构造">分步构造</a>
          <ol>
            <li><a href="#1-阶梯区间检测">1. 阶梯区间检测</a></li>
            <li><a href="#2-阶梯费用计算">2. 阶梯费用计算</a></li>
            <li><a href="#3-组合输出">3. 组合输出</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/">
                <img src="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/title_hu_7b2261281d684d3a.png"
                        srcset="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/title_hu_7b2261281d684d3a.png 800w, /p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/title_hu_a2b34cc9f3cd65c5.png 1600w"
                        width="800" 
                        height="579" 
                        loading="lazy"
                        alt="Featured image of post 一种有趣的数学构筑尝试" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E6%95%B0%E5%AD%A6/" >
                数学
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/">一种有趣的数学构筑尝试</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 04, 2025</time>
            </div>
        



        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 1 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h1 id="一种有趣的数学构筑法">一种有趣的数学构筑法
</h1><h1 id="一引言">一、引言
</h1><blockquote>
<p>在看到某些分段函数时，其中所蕴含的一种“不够直接”的感觉往往令我感到难受。我们是否能找到一种方式，来用任意一个函数拟合各种特别的分段函数呢？</p></blockquote>
<p>在必修一的课本上，存在这样一幅函数图像：</p>
<p><img src="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image1.PNG"
	width="714"
	height="223"
	srcset="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image1_hu_d2cee8ced6336d20.PNG 480w, /p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image1_hu_972c76ae32e404d7.PNG 1024w"
	loading="lazy"
	
		alt="image1"
	
	
		class="gallery-image" 
		data-flex-grow="320"
		data-flex-basis="768px"
	
></p>
<p>​	课本上对于该函数的表达式为：</p>
$$
y=\left|x-2k\right|\left(2k-1<x<2k+1\right)\left(k∈Z\right)
$$<p>​</p>
<p>然而，当我们尝试直接在<strong>desmos</strong>中使用这个公式时，我们会遇到这样的问题：</p>
<p><img src="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image2.PNG"
	width="447"
	height="80"
	srcset="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image2_hu_393f19cde03b419d.PNG 480w, /p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image2_hu_5913f80fb770f95e.PNG 1024w"
	loading="lazy"
	
		alt="image2"
	
	
		class="gallery-image" 
		data-flex-grow="558"
		data-flex-basis="1341px"
	
></p>
<p>​	让我们来考虑一个问题：<strong>能否不用这种带括号指定范围的分段函数，来实现相同的效果</strong>呢？</p>
<p>​	先看结论！这个函数，写成<strong>这样子</strong>（可以复制到desmos里尝试）：
</p>
$$
y = \left(\left(-1\right)^{1+\lceil x \rceil} \cdot \text{mod}\left(x, 1\right)\right) + \left(\text{mod}\left(\lfloor x \rfloor, 2\right)\right)
$$<p>
看上去相当的复杂，对吧？在介绍原理之前，我们可以再举一个例子：统计学的<strong>百分位数</strong>。
</p>
$$
P_k = 
\begin{cases} 
x_{\lfloor n \cdot k \rfloor + 1}, & \text{如果 } n \cdot k \text{ 不是整数} \\
\frac{x_{n \cdot k} + x_{n \cdot k + 1}}{2}, & \text{如果 } n \cdot k \text{ 是整数}
\end{cases}
$$<p>
这是它的常规公式。那么，我们能否找到一个<strong>独立</strong>的公式，效果却和百分位数<strong>一模一样</strong>呢？有的兄弟，有的！先看结论：
</p>
$$
t = \left( \frac{\lceil | n \times k\% - \lfloor n \times k\% \rfloor | \rceil + 1}{2} \right) \times X_{\lceil n \times k\% \rceil} + \left( \frac{|\lceil \text{mod}(n \times k\%, 1) \rceil - 1|}{2} \right) \times X_{\lceil n \times k\% \rceil + 1}
$$<p>
看上去似乎更加复杂了&hellip;那么，我们要如何写出这样的函数呢？让我们先来拆分下上面两个函数的思路！</p>
<h1 id="二逻辑拆分">二、逻辑拆分
</h1><p>尽管以上两个公式令人生畏，但其中包含一个清晰的逻辑。让我们对其进行具体分析：</p>
<h2 id="1锯齿函数">1.锯齿函数
</h2><p><img src="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image1.PNG"
	width="714"
	height="223"
	srcset="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image1_hu_d2cee8ced6336d20.PNG 480w, /p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image1_hu_972c76ae32e404d7.PNG 1024w"
	loading="lazy"
	
		alt="image1"
	
	
		class="gallery-image" 
		data-flex-grow="320"
		data-flex-basis="768px"
	
></p>
<p>观察原图像，我们可以分析一下其具备的规律：</p>
<ul>
<li>在所有的<strong>偶数到奇数</strong>段内，曲线从<code>0 - 1</code>上升。</li>
<li>在所有的<strong>奇数到偶数</strong>段内，曲线从<code>1 - 0</code>下降。</li>
</ul>
<p>规则很简单，我们要如何着手这个图像呢？既然我们不打算用括号显式的指定<strong>周期函数</strong>，那我们不妨用些现成的周期函数。观察<code>mod(x,1)</code>的图像，我们会发现，这和我们的目标很相似：</p>
<p><img src="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image3.PNG"
	width="1439"
	height="735"
	srcset="/p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image3_hu_c001e43574076636.PNG 480w, /p/%E4%B8%80%E7%A7%8D%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E5%AD%A6%E6%9E%84%E7%AD%91%E5%B0%9D%E8%AF%95/image3_hu_ad0b2b11eab1ee51.PNG 1024w"
	loading="lazy"
	
		alt="image1"
	
	
		class="gallery-image" 
		data-flex-grow="195"
		data-flex-basis="469px"
	
></p>
<p>很显然，这个图像在所有的<strong>偶数到奇数</strong>段完全正确！因此，我们要做的就是把偶数段和奇数段分开处理。怎么做到呢？</p>
<p>这里我们不妨看看另一个函数：<code>-1^n</code>。我们都知道，<strong>-1</strong>的<strong>奇数次幂</strong>为-1，<strong>偶数次幂</strong>为1。刚好，我们需要做到的效果是偶数次幂时方向取反。将<strong>偶数到奇数</strong>区段内的数进行<strong>向上取整</strong>会使其变成奇数，反之亦然。在这么做之后多取一个**-1**就可以达到效果！（其实直接向下取整也可以）</p>
<p>那么，我们就得到了第二个关键组件：
</p>
$$
\left(-1\right)^{1+\lceil x \rceil}
$$<p>
<img src="image4.PNG" alt="image1" style="zoom:75%;" /></p>
<p>所得图像如下。</p>
<p>接下来我们要将所有的<strong>偶数</strong>（奇数到偶数）区段+1。简单用一个取模函数加上向下取整即可：
</p>
$$
\left(\text{mod}\left(\lfloor x \rfloor, 2\right)\right)
$$<p>
那么，只要将这三个模块组合，就可以达到完整的函数效果。接下来，让我们分析一下第二个函数：</p>
<h2 id="2百分位数">2.百分位数
</h2><p>让我们先观察一下百分位数的逻辑：
</p>
$$
P_k = 
\begin{cases} 
x_{\lfloor n \cdot k \rfloor + 1}, & \text{如果 } n \cdot k \text{ 不是整数} \\
\frac{x_{n \cdot k} + x_{n \cdot k + 1}}{2}, & \text{如果 } n \cdot k \text{ 是整数}
\end{cases}
$$<p>
为了让式子尽可能的简单，我们来看看存在哪些点可以简化：</p>
<ul>
<li>首先，当<code>n*k</code>不是整数的时候，对其进行向下取整再加一完全可以等价于向上取整；</li>
<li>如果<em>n*k</em>是整数，n*k的向上取整值不变</li>
<li>那么，我们可以把逻辑简化为：一定会取一半的当前位数（指n*k向上取整位置）；如果是整数，就取一半下一位数的值；如果不是，则再取一半当前位数</li>
</ul>
<p>再完成这样的分析后，再来写式子就简单多了。</p>
<p>首先，我们肯定需要一个基底的一半当前位数：
</p>
$$
t = \frac{1}{2} \times X_{\lceil n \times k\% \rceil}
$$<p>
接下来，我们需要得到一个式子用来判断是否具备小数。有两个简单的式子可以达到这个目的：
</p>
$$
\lceil x-\lfloor x \rfloor\rceil  \\  \lceil mod(x,1) \rceil
$$<p>
这两个式子具备相同的效果，具体情况是：<strong>在有小数时输出<code>1</code>，否则输出<code>0</code></strong>。</p>
<p>我们只要用这个式子的结果乘以一半的<strong>当前位数</strong>的值，再拿式子的结果相反值乘以一半的<strong>下一位数</strong>的值，就可以达成目的了。那么，我们还需要一个取反的式子：
</p>
$$
-(x-1)  \\ |x-1|
$$<p>
这两个式子都可以达成完全相同的效果。那么，我们只要把数个模块组装起来，就可以得到最终式子：
</p>
$$
t = \left( \frac{\lceil | n \times k\% - \lfloor n \times k\% \rfloor | \rceil + 1}{2} \right) \times X_{\lceil n \times k\% \rceil} + \left( \frac{|\lceil \text{mod}(n \times k\%, 1) \rceil - 1|}{2} \right) \times X_{\lceil n \times k\% \rceil + 1}
$$<h2 id="3思考范式">3.思考范式
</h2><p>通过以上两个例子，我们可以注意到，这种方式可以找到一个共通的步骤：</p>
<ul>
<li>分析原式</li>
<li>找到规律</li>
<li>找出式子</li>
<li>组合</li>
</ul>
<p>分析原式和找到规律的部分似乎没有什么好用的快速方案，然而，式子中却似乎有很多部分是共通的！那么，我们不妨对常用的式子进行一个提取？</p>
<h1 id="三公式逻辑门">三、公式逻辑门
</h1><p>为了更好的运用这些公式进行组装，我们不妨采取一个<strong>统一的接口数字</strong>。那么，我们不妨设为<code>0和1</code>。其中，<strong>1</strong>代表<strong>是</strong>，0代表<strong>否</strong>！同时，为了方便，我们可以再取<code>1和-1</code>作为第二套逻辑标准。</p>
<h2 id="单位转化">单位转化
</h2><p>那么，当务之急就是先定义出两套标准的转化。我们不妨让0和-1互相转化：
</p>
$$
1,0 => 1,-1 : -(-1)^x \\ 1,0 <= 1,-1 :\frac{x+1}{2}
$$<p>
这两串有趣的式子就可以在x值合适的情况下完成转换的工作！接下来，我们再定义出几个有趣的小工具。</p>
<h2 id="符号提取">符号提取
</h2><p>符号提取可以将一个大小任意的数字转化到标准信号的一种之中。我们可以很自然的想到这样的方式：
</p>
$$
\frac{x}{|x|}
$$<p>
然而，这个式子不可兼容0 。那么，我们只能采取一个更加复杂的方案：
</p>
$$
\lceil( \frac{x}{ (|x|+1)} )\rceil -  \lceil(\frac {-x}{(|x|+1)} )\rceil
$$<p>
不过，在确认输入值 ≠0 的情况下，可以采用第一种方案。</p>
<h2 id="提取小数">提取小数
</h2><p>提取小数可以用这两个简单的公式。同时，如果想表达是否“存在小数”，则进行向上取整即可：
</p>
$$
x-\lfloor x \rfloor \\ mod(x,1)
$$<h2 id="非运算">非运算
</h2><p>1和-1的非运算再简单不过。我们考虑1和0的非运算：(两式效果相同)
</p>
$$
|x-1| \\ -(x-1)
$$<h2 id="与运算">与运算
</h2><p>我们同样有多种方法可以实现该效果：
</p>
$$
\lfloor\frac{x_1+x_2}{2}\rfloor  \\  x1\times x2
$$<h2 id="或运算">或运算
</h2><p>我们可以按照逻辑门的角度考虑：非（（非1）与（非2））即或。或者，我们可以用向上取整：
</p>
$$
\lceil\frac{x_1+x_2}{2}\rceil
$$<p>
其实，拥有了以上三种门之后我们可以构筑出更多东西。在此并不一一列举，不过我们可以尝试构筑一下异或：</p>
<h2 id="异或运算">异或运算
</h2><p>我们采用这个逻辑：（1 与 非2）或 （非1 与 2）：
</p>
$$
\lceil\frac{[(x1\times-(x2-1))+(x2\times-(x1-1))]}{2}\rceil
$$<h2 id="奇偶切割">奇偶切割
</h2><p>我们可以通过以下两种方式将奇数部分和偶数部分切割。其中，前一种方案采取的是<code>1/-1</code>编码，后一种采取的是<code>0,1</code>编码：
</p>
$$
(-1)^{\lfloor x\rfloor+1}  \\  mod(\lceil x\rceil,2)
$$<h2 id="周期性取值">周期性取值
</h2><p>用于在满足<strong>周期n</strong>时取到<strong>值k</strong>:（可以做成周期性添值或者乘值）
</p>
$$
k|[mod(\lceil x \rceil,n)]-1|
$$<h2 id="判断大小">判断大小
</h2><p>判断x是否大于（或小于）某个数k，可以直接将x与k相减，再通过提取符号观察正负即可：
</p>
$$
\frac{(x-k)}{|(x-k)|}(x≠0) \\\\ \lceil( \frac{(x-k)}{ (|(x-k)|+1)} )\rceil -  \lceil(\frac {-(x-k)}{(|(x-k)|+1)} )\rceil
$$<p>
如果想要判断是否在一定范围内，判断两次然后用与运算即可。</p>
<h2 id="选择器">选择器
</h2><p>选择器只要根据条件在两种值中选择一种即可，实现上也非常简单（条件为k，两种情况分别为x1 x2）：
</p>
$$
k(x_1)-(k-1)(x_2)
$$<h2 id="多重与多重或">多重与&amp;多重或
</h2><p>多重与和多重或只需要用连乘和连加即可：
</p>
$$
\prod_{i=1}^{n} x_i  \\ \lceil\frac{1}{n}\sum_{i=1}^{n} x_i\rceil
$$<h2 id="判断数值">判断数值
</h2><p>要判断x是否等于某个特定的值（k），我们只需要将x-k带进符号判断公式中，并将-1设为1再取反即可：
</p>
$$
(|\lceil( \frac{x-k}{ (|x-k|+1)} )\rceil -  \lceil(\frac {-(x-k)}{(|x-k|+1)} )\rceil|-1)
$$<h2 id="区间二分">区间二分
</h2><p>让x在每个区间k内，将前半段和后半段进行区分（返回值0,1）：
</p>
$$
\lfloor\frac {mod(x,k)}{k}+\frac{1}{2}\rfloor
$$<h1 id="四实战">四、实战
</h1><p>我们现在可以来快速尝试将上述的内容运用到实战：</p>
<h2 id="尝试1relu线性整流函数">尝试1：ReLU（线性整流函数）
</h2><p>RuLU函数的基础函数是：
</p>
$$
\max(0,x)
$$<p>
我们能否使用上述的内容来完成Relu呢？我们只需要用一个判断函数，在x的前面加上系数：x&gt;0的判断，并将-1转化成0即可（为了实现这个目的，加一再除以2再向下取整）。式子如下：
</p>
$$
x(\lfloor\frac{\lceil( \frac{(x-k)}{ (|(x-k)|+1)} )\rceil -  \lceil(\frac {-(x-k)}{(|(x-k)|+1)} )\rceil+1\lfloor}{2})
$$<p>
不过，这种方案是直接套模块得到的，我们还有更简单的方案，不过要具体分析情况得到了：
</p>
$$
\frac{(x + |x|)}{2}
$$<h2 id="尝试2自定义函数">尝试2：自定义函数
</h2><h3 id="场景设定">场景设定
</h3><p>假设电费按用量分段计费：</p>
<ul>
<li><strong>第一阶梯</strong>（0~100度）：每度0.5元</li>
<li><strong>第二阶梯</strong>（100~200度）：超出100度的部分每度0.8元</li>
<li><strong>第三阶梯</strong>（&gt;200度）：超出200度的部分每度1.2元</li>
</ul>
<h3 id="分步构造">分步构造
</h3><h4 id="1-阶梯区间检测">1. 阶梯区间检测
</h4><p>我们需要三个逻辑信号（1表示属于该区间，0表示不属于）：</p>
<ul>
<li><strong>k₁</strong>（第一阶梯）：x ∈ [0,100]</li>
<li><strong>k₂</strong>（第二阶梯）：x ∈ (100,200]</li>
<li><strong>k₃</strong>（第三阶梯）：x &gt; 200</li>
</ul>
<p><strong>构造方法：</strong></p>
<ul>
<li>
<p>用<strong>符号差+取整</strong>检测边界：</p>
<ul>
<li>
$$
    k_1 = \lceil \frac{100 - x + |100 - x|}{2(100 - x + |100 - x|) + 1} \rceil - \lceil \frac{x - 100 + |x - 100|}{2(x - 100 + |x - 100|) + 1} \rceil + 1
    $$</li>
<li>
$$
    k_2 = \text{类似方法检测 } (100,200]
    $$</li>
<li>
$$
    k_3 = \lceil \frac{x - 200}{x - 200 + |x - 200| + 1} \rceil
    $$</li>
</ul>
</li>
</ul>
<h4 id="2-阶梯费用计算">2. 阶梯费用计算
</h4><ul>
<li>$$
   第一阶梯费用：0.5x \cdot k_1\\
  第二阶梯费用：[50 + 0.8(x-100)] \cdot k_2\\
  第三阶梯费用：[130 + 1.2(x-200)] \cdot k_3\\
  $$</li>
</ul>
<h4 id="3-组合输出">3. 组合输出
</h4><p>总费用 = 第一阶梯费用 + 第二阶梯费用 + 第三阶梯费用
通过<strong>逻辑门</strong>确保只有当前阶梯信号为1时生效：</p>
<p>$$
\begin{aligned}
\text{Cost}(x) = \ &amp;
\frac{x}{2} \left( \left\lfloor \frac{A_1}{2A_1+1} \right\rfloor - \left\lfloor \frac{B_1}{2B_1+1} \right\rfloor + 1 \right) \</p>
<ul>
<li>\ &amp;
\left( 50 + \frac{4(x-100)}{5} \right) \left( \left\lfloor \frac{A_2}{2A_2+1} \right\rfloor - \left\lfloor \frac{B_2}{2B_2+1} \right\rfloor - k_1 + 1 \right) \</li>
<li>\ &amp;
\left( 130 + \frac{6(x-200)}{5} \right) \left\lceil \frac{x-200}{C+1} \right\rceil
\end{aligned}
$$</li>
</ul>
$$
\begin{aligned}
A_1 &= 100 - x + |100 - x|, \quad B_1 = x - 100 + |x - 100| \\
A_2 &= 200 - x + |200 - x|, \quad B_2 = x - 200 + |x - 200| \\
C &= x - 200 + |x - 200|, \quad k_1 = \left\lfloor \frac{A_1}{2A_1+1} \right\rfloor - \left\lfloor \frac{B_1}{2B_1+1} \right\rfloor + 1
\end{aligned}
$$<h1 id="五总结">五、总结
</h1><p>这种方法看上去会将简单的函数大幅复杂化，最终得到一个尽管效果相同但式子复杂上许多，但成功消灭了括号和具体的“规则”的式子。同时，这种思维方式相当系统化和模块化，可以实现一种有趣的自由组装的效果，类似于程序一样。</p>
<p>希望这种方法能够具备一定的参考价值！</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a>
        
            <a href="/tags/%E6%95%B0%E5%AD%A6/">数学</a>
        
    </section>


    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Jun 05, 2025 07:55 &#43;0800
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo=""
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 疏间徒泍
    </section>
    
    <section class="powerby">
        
            步履不止，朝向远方 <br/>
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<style>
  body {
    background: url(https://SJTdreams.github.io/background/NaHiDa.jpg) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;

  }
</style>
<div id="particles-js"></div>

<script src=https://SJTdreams.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://SJTdreams.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<div id="aplayer"></div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script>
    
    const cssPath = "https://SJTdreams.github.io/waifu/waifu.css"
    const tipsJsonPath = "https://SJTdreams.github.io/waifu/waifu-tips.json"
    
    const live2d_path = "https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/";

    
    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            }
            else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }

    
    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(cssPath, "css"),
            loadExternalResource(live2d_path + "live2d.min.js", "js"),
            loadExternalResource(live2d_path + "waifu-tips.js", "js")
        ]).then(() => {
            
            initWidget({
                waifuPath: tipsJsonPath,
                cdnPath: "https://cdn.jsdelivr.net/gh/SJTDreams/BlogModel@v0.0.1/",
                tools: ["hitokoto", "asteroids", "switch-model", "switch-texture", "photo", "info", "quit"]
            });
            initWaifuMouseEvent();
        });
    }
    function initWaifuMouseEvent() {
        const waifu = document.getElementById("waifu");
        let isDown = false;
        let waifuLeft;
        let mouseLeft;
        let waifuTop;
        let mouseTop;
        
        waifu.onmousedown = function (e) {
            isDown = true;
            
            waifuLeft = waifu.offsetLeft;
            mouseLeft = e.clientX;
            
            waifuTop = waifu.offsetTop;
            mouseTop = e.clientY;
        }
        
        window.onmousemove = function (e) {
            if (!isDown) {
                return;
            }
            
            let currentLeft = waifuLeft + (e.clientX - mouseLeft);
            if (currentLeft < 0) {
                currentLeft = 0;
            } else if (currentLeft > window.innerWidth - 300) {
                currentLeft = window.innerWidth - 300;
            }
            waifu.style.left = currentLeft  + "px";
            
            let currentTop = waifuTop + (e.clientY - mouseTop);
            if (currentTop < 30) {
                currentTop = 30
            } else if (currentTop > window.innerHeight - 290) {
                currentTop = window.innerHeight - 290
            }
            waifu.style.top = currentTop + "px";
        }
        
        window.onmouseup = function (e) {
            isDown = false;
        }
    }
</script>


<script>
    function showHideView() {
        
        let viewCounts = document.querySelectorAll("#viewCount");
        if (viewCounts) {
            
            let article =  document.querySelector(".article-page");
            if (!article) {
                viewCounts.forEach(ele => {
                    ele.style.display = 'none';
                });
            }
        }
    }
    
    showHideView();
</script>

<script>
const staticDir = "https://SJTdreams.github.io/"
const ap = new APlayer({
    container: document.getElementById('aplayer'),
    lrcType: 3,
    audio: [
        {
            
            name: '冬之钟OST',
            artist: '寿司勇者',
            url: staticDir + '冬之钟.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
             name: '【Remix】背叛的爱丽丝', 
             artist: 'MYANSR', 
             url: 'Alice.mp3', 
             cover: 'blacksouls.jpg', 
             lrc: 'lrc.lrc', 
        },
        {
             name: 'Are You Lost', 
             artist: 'park bird', 
             url: 'Are You Lost.mp3', 
             cover: 'lost.png', 
             lrc: 'lrc.lrc', 
        },
        {
             name: 'Be Lost', 
             artist: '路灰气球z', 
             url: 'Be Lost.mp3', 
             cover: 'lost.png', 
             lrc: 'lrc.lrc', 
        },
        {
             name: 'INTERNET YAMERO', 
             artist: 'KOTOKO', 
             url: '升天.mp3', 
             cover: 'fly.png', 
             lrc: 'lrc.lrc', 
        },
        {
            
            name: '古兰战bgm-blacksoulsII',
            artist: '寿司勇者',
            url: staticDir + '古兰.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: 'BlackSouls2 OST - 狩猎邪龙的沃柏尔',
            artist: '寿司勇者',
            url: staticDir + '邪龙.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: 'BlackSouls2 OST - 地狱王子(安德烈·德·洛德)',
            artist: '寿司勇者',
            url: staticDir + '地狱王子.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: 'BlackSouls2 OST - VS虚无少女梅贝尔 (Update Patch ver.)',
            artist: '寿司勇者',
            url: staticDir + '梅贝尔.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: '【Future House】- Index',
            artist: 'Kirara Magic',
            url: staticDir + 'index.mp3',
            cover: staticDir + 'piara.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: '𝕷𝖆𝖘𝖙 𝕯𝖆𝖓𝖈𝖊',
            artist: 'Xomu',
            url: staticDir + 'lastdance.mp3',
            cover: staticDir + 'last dance.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: '虹の蝶：Summer Pockets Original SoundTrack',
            artist: 'Key Sounds Label',
            url: staticDir + 'sp.mp3',
            cover: staticDir + 'sp.jpg',
            lrc: staticDir + 'lrc.lrc',
        }
        
    ]
});
window.onbeforeunload = () => {
        
        const playInfo = {
            index: ap.list.index,
            currentTime: ap.audio.currentTime,
            paused: ap.paused
        };
        localStorage.setItem("playInfo", JSON.stringify(playInfo));
    };
    

    window.onload = () => {
        
        const playInfo = JSON.parse(localStorage.getItem("playInfo"));
        if (!playInfo) {
            return;
        }
        
        ap.list.switch(playInfo.index);
        
        setTimeout(() => {
            
            ap.seek(playInfo.currentTime);
            
            if (!playInfo.paused) {
                ap.play()
            }
        }, 500);
    };

</script>
<script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script>
<script>
	var pjax = new Pjax({
	  selectors: [
	    ".main-container"
	  ]
	})
    pjax._handleResponse = pjax.handleResponse;
    pjax.handleResponse = function(responseText, request, href, options) {
        if (request.responseText.match("<html")) {
            
            let newDom = new DOMParser().parseFromString(responseText, 'text/html');
            
            let bodyClass = newDom.body.className;
            document.body.setAttribute("class", bodyClass)
            
            pjax._handleResponse(responseText, request, href, options);
        } else {
            
        }
    }
    document.addEventListener('pjax:complete', () => {
        
        window.Stack.init();
    })
</script>


    </body>
</html>
